# 一. 追踪性能问题

性能评估对大多数软件产品来说是一个系统的过程。首先，我们要确定的是系统性能表现的最高与最低的衡量权值，比如内存可用量，可以接受的CPU占用率，并发用户的数量，等等。然后，我们会针对发布到特定平台的应用程序，进行脚本化测试，同时对测试数据表格化。但完成测试数据的采集后，我们分析和查找其中的性能瓶颈。如果发现了问题，我们需要针对该问题进行真因分析（RCA），通过改变程序配置或者程序代码解决该问题，并重复此过程修复其他问题。

虽然游戏开发是一个非常艺术化的工程，但它也是个技术含量很高的事情，所以仍然需要客观的认真对待。我们应该了解游戏产品的受众对象，才会搞清楚我们的游戏将会在怎样的硬件配置下运行，也才会知晓游戏性能需要满足哪些目标条件。我们可以在运行时对游戏进行性能采样测试，从多个系统（GPU，CPU，内存，物理引擎，渲染管线等等）收集性能指标数据，并我们心中期望的可接受值进行对比。我们使用测试数据去定位我们程序中的性能瓶颈，使用Unity引擎附带的分析工具，来确定问题的根本来源。最后，根据问题的类型，我们提出一些修复方案，提升游戏的性能表现。

不过，在我们提出修复方案并花时间去修复的前提是，我们要能够证明该性能问题的是确确实实存在的。在项目未进行系统优化之前，没有充足的理由，就去修改重构代码是不明智的选择。一旦我们有足够的证据证明性能问题，下一步就是定位瓶颈点。明白为什么出现此性能问题非常重要。否则我们仅仅凭借无根据的猜想，将会在修复问题上花费更多的时间。如此已来也意味着我们只是治标而不治本，该问题会在以后的工作中以另一种或者以我们还未察觉到的形式来影响性能。

在本章节中，将会有如下内容：

 - 如何使用Unity Profiler获取分析数据
 - 如何分析Profiler数据查找性能瓶颈
 - 如何从技术上定位性能问题的本因并如何避免该问题的发生
 
 通过对列举出的性能问题的深入了解，你就可以更清晰的学习以后关于性能问题解决方案的相关章节内容。


## 1.性能分析工具Profiler

Unity Profiler是Unity编辑器中内置的工具，我们通过他提供的可视化的关于Unity3D运行时多个子系统的性能统计报告，很方便快捷的缩小我们的性能问题查找范围。它可提供相关数据的的子系统如下：

 - CPU的使用率
 - 简明或者详细的渲染情况和GPU的信息
 - 运行时内存的分配情况和总的使用量
 - 声源或者声音数据的使用情况
 - 物理引擎（2D 和 3D）的使用情况
 - 网络消息接受发送和处理情况
 - 视频播放的信息
 - 基本或详细的UI性能信息（2017版本中的新功能）
 - 全局光照统计信息（2017版本中的新功能）

